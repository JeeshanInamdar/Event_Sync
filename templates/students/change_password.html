{% extends 'base.html' %}

{% block title %}Change Password - {{ student.get_full_name }}{% endblock %}

{% block extra_css %}
<style>
    .auth-container {
        min-height: calc(100vh - 120px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }

    .auth-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        padding: 1.5rem;
    }

    .auth-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .auth-header h1 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .auth-header p {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .form-group {
        margin-bottom: 1.25rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.75rem;
        margin-top: 2rem;
    }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .required {
        color: #ef4444;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        transition: border-color 0.2s;
    }

    .form-input:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .form-input.error {
        border-color: #ef4444;
    }

    .form-help {
        display: block;
        font-size: 0.8125rem;
        color: #6b7280;
        margin-top: 0.375rem;
    }

    .form-error {
        display: block;
        font-size: 0.875rem;
        color: #ef4444;
        margin-top: 0.375rem;
        min-height: 1.25rem;
    }

    .btn {
        font-size: 1rem;
        font-weight: 500;
        padding: 0.75rem;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
        min-height: 48px;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-primary {
        background: #4f46e5;
        color: white;
    }

    .btn-primary:hover {
        background: #4338ca;
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn-secondary:hover {
        background: #4b5563;
    }

    .btn-block {
        width: 100%;
    }

    /* Tablet and larger */
    @media (min-width: 640px) {
        .auth-card {
            padding: 2rem;
        }

        .auth-header h1 {
            font-size: 1.875rem;
        }

        .auth-header p {
            font-size: 1rem;
        }

        .form-row {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1>Change Password</h1>
            <p>{{ student.get_full_name }} ({{ student.usn }})</p>
        </div>

        <form method="POST" action="{% url 'student_change_password' %}" id="changePasswordForm">
            {% csrf_token %}

            <!-- Current Password -->
            <div class="form-group">
                <label for="current_password" class="form-label">
                    Current Password <span class="required">*</span>
                </label>
                <input
                    type="password"
                    id="current_password"
                    name="current_password"
                    class="form-input"
                    placeholder="Enter current password"
                    required
                    autocomplete="current-password"
                >
                <span class="form-error" id="current_password-error"></span>
            </div>

            <!-- New Password -->
            <div class="form-group">
                <label for="new_password" class="form-label">
                    New Password <span class="required">*</span>
                </label>
                <input
                    type="password"
                    id="new_password"
                    name="new_password"
                    class="form-input"
                    placeholder="Enter new password"
                    required
                    autocomplete="new-password"
                >
                <span class="form-help">Minimum 8 characters</span>
                <span class="form-error" id="new_password-error"></span>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
                <label for="confirm_password" class="form-label">
                    Confirm New Password <span class="required">*</span>
                </label>
                <input
                    type="password"
                    id="confirm_password"
                    name="confirm_password"
                    class="form-input"
                    placeholder="Re-enter new password"
                    required
                    autocomplete="new-password"
                >
                <span class="form-error" id="confirm_password-error"></span>
            </div>

            <!-- Buttons -->
            <div class="form-row">
                <a href="{% url 'student_profile' %}" class="btn btn-secondary btn-block">
                    Cancel
                </a>
                <button type="submit" class="btn btn-primary btn-block">
                    Change Password
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
        // Clear previous errors
        document.querySelectorAll('.form-error').forEach(el => el.textContent = '');
        document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));

        let isValid = true;
        let firstError = null;

        // Validate current password
        const currentPassword = document.getElementById('current_password').value;
        if (!currentPassword) {
            document.getElementById('current_password-error').textContent = 'Current password is required';
            document.getElementById('current_password').classList.add('error');
            if (!firstError) firstError = document.getElementById('current_password');
            isValid = false;
        }

        // Validate new password
        const newPassword = document.getElementById('new_password').value;
        if (newPassword.length < 8) {
            document.getElementById('new_password-error').textContent = 'Password must be at least 8 characters';
            document.getElementById('new_password').classList.add('error');
            if (!firstError) firstError = document.getElementById('new_password');
            isValid = false;
        }

        // Check if new password is same as current
        if (newPassword && currentPassword && newPassword === currentPassword) {
            document.getElementById('new_password-error').textContent = 'New password must be different from current password';
            document.getElementById('new_password').classList.add('error');
            if (!firstError) firstError = document.getElementById('new_password');
            isValid = false;
        }

        // Validate confirm password
        const confirmPassword = document.getElementById('confirm_password').value;
        if (newPassword !== confirmPassword) {
            document.getElementById('confirm_password-error').textContent = 'Passwords do not match';
            document.getElementById('confirm_password').classList.add('error');
            if (!firstError) firstError = document.getElementById('confirm_password');
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            // Scroll to first error field
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstError.focus();
            }
        }
    });

    // Remove error styling on input
    ['current_password', 'new_password', 'confirm_password'].forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.addEventListener('input', function() {
                this.classList.remove('error');
                const errorElement = document.getElementById(field + '-error');
                if (errorElement) {
                    errorElement.textContent = '';
                }
            });
        }
    });
</script>
{% endblock %}